<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>WESA Test</title>
    <link rel="stylesheet" type="text/css" href="../css/tester.css">
</head>

<body>

    <div class="flex-wrapper">
        <canvas id="canvas" width="640" height="480"></canvas>
    </div>
    <div class="dynamic-output" id="output">Scrolling Tile Array</div>

    <script src="../../src/wesa.js"></script>

    <script>

        var tiles = [];

        function addTiles(scene, count, width, scaling) {
            let x = (-width / 2 * scaling) * (count - 2);
            for (let i = 0; i < count; i++) {
                let tile = new wesa.Sprite({
                    object: wesa.assets.objectList[0],
                    action: 0,
                    position: { x: x, y: -180 },
                    team: 0,
                    scale: scaling
                });
                tile.velocity.x = -1;
                tiles.push(tile);
                x += width * scaling;
                scene.addSpriteToLayer(0, tile);
            }
        }

        // Initialize WESA
        wesa.core.init(document.getElementById('canvas'));

        // Adding assets ready for loading
        wesa.assets.source.spriteSheetUrlArray.push('./tileset.png');
        wesa.assets.source.objectJsonUrl = './objects.json';

        // Load assets
        wesa.assets.load(function () {

            // Create the scene
            var scene = new wesa.Scene('Scene');

            let count = 12, width = 16, scaling = 4;
            let left = (-width / 2 * scaling) * (count);
            let right = -left;
            addTiles(scene, count, width, scaling);

            // Run the scene
            var animate = function () {
                requestAnimationFrame(animate);


                for (let i = 0; i < tiles.length; i++) {
                    let tile = tiles[i];
                    if (tile.position.x <= left) { tile.position.x = right; }
                }


                scene.update();
                scene.render();
            }
            animate();

        });

    </script>

</body>

</html>
