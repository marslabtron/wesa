<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>Hello WESA</title>
    <link rel="stylesheet" type="text/css" href="./css/demo-iframe.css">
</head>

<body>

    <div class="flex-wrapper">
        <canvas id="canvas" width="600" height="800"></canvas>
    </div>
    <div class="dynamic-output" id="output">WESA Galaxian Plus</div>
    
    <script src="../js/wesa.js"></script>
    
    <script>
        
        const canvas = document.getElementById('canvas');
        const dim = {
            top: canvas.height / 2,
            bottom: -canvas.height / 2,
            left: -canvas.width / 2,
            right: canvas.width / 2
        };
        
        var stars = [];
        var player = null;
        
        function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function addStar(scene) {
            let star = new wesa.Sprite({
                object: wesa.assets.objectList[0],
                action: 0,
                team: 0,
                position: { x: getRandomIntInclusive(dim.left, dim.right), y: getRandomIntInclusive(dim.bottom, dim.top) },
                scale: 1
            });
            star.velocity.y = -2 + Math.random();
            let endTimes = star.getCurrentAnim().endTimeList;
            star.setTime(getRandomIntInclusive(0, endTimes[endTimes.length - 1]) - 1);  
            stars.push(star);
            scene.addSpriteToLayer(0, star);
        }
        
        // Initialize WESA
        wesa.core.init(document.getElementById('canvas'));
        
        // Adding assets ready for loading
        wesa.assets.source.spriteSheetUrlArray.push('../assets/texture/galaxian.png');
        wesa.assets.source.objectJsonUrl = '../assets/galaxian.json';
        
        // Load assets
        wesa.assets.load(function () {
        
            // Create the scene
            var scene = new wesa.Scene('Scene');
            
            // Background
            for (let i = 0; i < 30; i++) {
                addStar(scene);
            }
            
            // Player
            player = new wesa.Sprite({
                object: wesa.assets.objectList[1],
                action: 0,
                team: 0,
                position: { x: 0, y: -250 },
                scale: 2
            });
            scene.addSpriteToLayer(1, player);
            
            // Run the scene
            var animate = function () {
            
                for (let i = 0; i < stars.length; i++) {
                    let star = stars[i];
                    if (star.position.y < dim.bottom) {
                        star.position.x = getRandomIntInclusive(dim.left, dim.right);
                        star.position.y = dim.top;
                    }
                }
            
                requestAnimationFrame(animate);
                scene.update();
                scene.render();
            }
            animate();
            
        });

    </script>
    
</body>

</html>
