<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>Tank</title>
    <link rel="stylesheet" type="text/css" href="../css/demo-iframe.css">
</head>

<body>

    <div class="flex-wrapper">
        <canvas id="canvas" width="480" height="480"></canvas>
    </div>
    <div class="dynamic-output" id="output"><img src="./assets/stage_1.png" id="map" /></div>

    <script src="../../js/wesa.js"></script>
    <script src="./js/opencity.js"></script>

    <script>

        document.onkeydown = function (e) {
            switch (e.key) {
                case 'ArrowUp':
                    OC.ref.keyStatus.up = true;
                    break;
                case 'ArrowDown':
                    OC.ref.keyStatus.down = true;
                    break;
                case 'ArrowLeft':
                    OC.ref.keyStatus.left = true;
                    break;
                case 'ArrowRight':
                    OC.ref.keyStatus.right = true;
                    break;
                case 'z':
                    OC.ref.keyStatus.fire = true;
                    break;
                default:
                    break;
             }
        }

        document.onkeyup = function (e) {
            switch (e.key) {
                case 'ArrowUp':
                    OC.ref.keyStatus.up = false;
                    break;
                case 'ArrowDown':
                    OC.ref.keyStatus.down = false;
                    break;
                case 'ArrowLeft':
                    OC.ref.keyStatus.left = false;
                    break;
                case 'ArrowRight':
                    OC.ref.keyStatus.right = false;
                    break;
                case 'z':
                    OC.ref.keyStatus.fire = false;
                    break;
                default:
                    break;
             }
        }

        // Initialize WESA
        wesa.core.init(document.getElementById('canvas'));

        // Adding assets ready for loading
        wesa.assets.source.spriteSheetUrlArray = [
            './assets/bc_0.png',
            './assets/bc_1.png'
        ];
        wesa.assets.source.objectJsonUrl = './assets/tank.json';

        // Load assets
        wesa.assets.load(function () {

            // Create the scene
            let scene = new wesa.Scene('Scene');

            // Create the map on the scene
            let map = new OC.Map({
                scene: scene,
                imgID: 'map',
                tileWidth: 16,
                tileHeight: 16
            });
            map.draw();

            // Run the scene
            let animate = function () {
                requestAnimationFrame(animate);
                OC.ref.player.takeControl(OC.ref.keyStatus);
                scene.update();
                OC.func.processCollision(scene.getCollisions({ collisionMatrix: OC.config.CollisionMatrix }));
                document.getElementById('output').innerText = wesa.stat.collisionChecks;
                scene.render();
            }
            animate();

        });

    </script>

</body>

</html>
